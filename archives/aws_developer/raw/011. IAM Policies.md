# 011. 🔐 AWS IAM 정책 딥다이브: 효과적인 권한 관리와 JSON 구조 이해

AWS Identity and Access Management(IAM) 정책은 클라우드 환경에서 리소스 접근을 안전하게 제어하는 핵심 요소입니다. 이 아티클에서는 IAM 정책이 사용자, 그룹, 역할에 어떻게 적용되고 상속되는지 깊이 있게 다루고, 정책을 구성하는 JSON 문서의 구조와 각 요소의 역할을 상세히 분석합니다. 효과적인 AWS 리소스 관리를 위한 IAM 정책의 모든 것을 함께 알아보겠습니다.

---

### AWS IAM 정책의 기본: 누가, 무엇을, 어떻게?

AWS 클라우드 환경에서 보안은 최우선 과제이며, IAM은 이 보안 아키텍처의 중심에 있습니다. IAM 정책은 특정 주체가 어떤 AWS 리소스에 대해 어떤 작업을 수행할 수 있는지 정의하는 권한 문서입니다. 이는 "누가(Principal) 무엇을(Action) 어떤 리소스에(Resource) 허용하거나(Allow) 거부할 것인가(Deny)"를 명확히 하는 역할을 합니다.

### 권한 부여 방식: 그룹, 사용자 및 인라인 정책

IAM 정책은 다양한 방식으로 사용자에게 권한을 부여할 수 있으며, 그 적용 방식에 따라 유연한 권한 관리가 가능합니다.

#### 1. 그룹 정책 (Group Policies)
그룹 정책은 여러 사용자를 한데 묶어 공통된 권한을 부여할 때 매우 효과적입니다. 예를 들어, '개발자' 그룹에 S3 버킷에 대한 읽기/쓰기 정책을 연결하면, 해당 그룹에 속한 모든 사용자(Alice, Bob, Charles)는 자동으로 동일한 권한을 상속받습니다. 이는 개별 사용자마다 일일이 정책을 연결하는 번거로움을 줄여주고, 권한 관리의 일관성을 유지하는 데 도움을 줍니다.

#### 2. 사용자별 인라인 정책 (Inline Policies for Users)
때로는 특정 사용자에게만 고유한 권한이 필요한 경우가 있습니다. '인라인 정책'은 그룹에 속하지 않거나, 그룹 정책 외에 추가적인 개별 권한이 필요한 사용자(Fred)에게 직접 연결되는 정책을 의미합니다. 인라인 정책은 해당 사용자와 정책의 생명 주기가 함께하며, 사용자가 삭제될 때 함께 제거됩니다.

#### 3. 다중 그룹 소속 및 권한 상속 (Multiple Group Memberships and Inheritance)
사용자는 하나 이상의 IAM 그룹에 소속될 수 있습니다. 만약 Charles가 '개발자' 그룹과 '감사팀' 그룹에 모두 소속되어 있다면, Charles는 두 그룹에 연결된 모든 정책의 권한을 상속받게 됩니다. 마찬가지로 David가 '운영팀'과 '감사팀'에 소속되어 있다면, 두 그룹의 정책이 모두 적용됩니다. 이 경우, 모든 적용 가능한 정책 중에서 가장 넓은 범위의 허용(Allow) 권한이 우선적으로 적용됩니다 (명시적인 거부(Deny) 정책이 없는 한).

**적용 예시:**

| 사용자 | 소속 그룹          | 적용 정책                         |
| :----- | :----------------- | :-------------------------------- |
| Alice  | 개발자             | 개발자 그룹 정책                  |
| Bob    | 개발자             | 개발자 그룹 정책                  |
| Charles| 개발자, 감사팀     | 개발자 그룹 정책 + 감사팀 그룹 정책 |
| David  | 운영팀, 감사팀     | 운영팀 그룹 정책 + 감사팀 그룹 정책 |
| Fred   | (그룹 없음), (사용자 인라인 정책) | 인라인 정책만 (또는 그룹에 속하면서 인라인 정책 추가) |

### IAM 정책의 구조: JSON 문서 해부

IAM 정책은 JSON(JavaScript Object Notation) 형식의 문서로 정의됩니다. 이 JSON 문서는 AWS 리소스에 대한 권한 부여 방식을 명확하게 설명합니다. 다음은 IAM 정책의 핵심 구성 요소입니다.

```json
{
  "Version": "2012-10-17",
  "Id": "OptionalPolicyID",
  "Statement": [
    {
      "Sid": "OptionalStatementID",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:root"
      },
      "Action": [
        "s3:ListBucket",
        "s3:GetObject"
      ],
      "Resource": "arn:aws:s3:::my-example-bucket/*",
      "Condition": {
        "IpAddress": {
          "aws:SourceIp": "203.0.113.0/24"
        }
      }
    }
  ]
}
```

#### 1. Version
*   **설명**: 정책 언어의 버전을 정의합니다. 현재 대부분 `2012-10-17` 버전을 사용합니다. 이는 정책 문법 및 기능에 대한 표준을 나타냅니다.
*   **예시**: `"Version": "2012-10-17"`

#### 2. Id (선택 사항)
*   **설명**: 정책을 고유하게 식별하는 선택적 식별자입니다. 주로 로깅이나 디버깅 시 정책을 쉽게 참조하기 위해 사용됩니다.
*   **예시**: `"Id": "S3AccessPolicyForDevelopers"`

#### 3. Statement
*   **설명**: 하나 이상의 권한 문(Statement) 배열입니다. 각 문은 특정 권한 세트를 정의합니다. 정책은 여러 개의 `Statement`를 가질 수 있습니다.

    *   **Sid (Statement ID, 선택 사항)**
        *   **설명**: 특정 `Statement`를 식별하는 선택적 식별자입니다. 여러 문이 있을 때 특정 문을 참조하거나 디버깅할 때 유용합니다.
        *   **예시**: `"Sid": "AllowS3ReadWrite"`

    *   **Effect**
        *   **설명**: 이 문이 접근을 `허용(Allow)`할지 `거부(Deny)`할지를 정의합니다. 이는 IAM 정책에서 가장 중요한 요소 중 하나입니다.
        *   **예시**: `"Effect": "Allow"` 또는 `"Effect": "Deny"`

    *   **Principal (일부 정책 유형에만 해당)**
        *   **설명**: 이 정책이 적용될 대상 계정, 사용자, 역할 또는 서비스를 지정합니다. 리소스 기반 정책(예: S3 버킷 정책)에서 주로 사용됩니다. 사용자 기반 정책에서는 일반적으로 이 필드가 생략됩니다.
        *   **예시**: `"Principal": {"AWS": "arn:aws:iam::123456789012:root"}` (루트 계정), `"Principal": {"AWS": ["ARN1", "ARN2"]}` 또는 `"Principal": "*"` (모든 주체)

    *   **Action**
        *   **설명**: `Effect`에 따라 허용되거나 거부될 AWS API 호출 또는 작업 목록입니다. 각 서비스마다 고유한 작업 이름이 있습니다 (예: S3 서비스의 `s3:GetObject`). `*`를 사용하여 해당 서비스의 모든 작업을 지정할 수 있습니다.
        *   **예시**: `"Action": ["s3:GetObject", "s3:PutObject"]` 또는 `"Action": "s3:*" `

    *   **Resource**
        *   **설명**: `Action`이 적용될 AWS 리소스 목록입니다. 리소스는 ARN(Amazon Resource Name) 형식으로 지정됩니다. `*`를 사용하여 모든 리소스에 적용할 수 있습니다.
        *   **예시**: `"Resource": "arn:aws:s3:::my-example-bucket/*"` (특정 S3 버킷 내의 모든 객체), `"Resource": "*"`

    *   **Condition (선택 사항)**
        *   **설명**: 이 문이 적용될 시점을 정의하는 선택적 조건입니다. IP 주소, 시간대, 특정 태그 등 다양한 조건을 사용하여 권한 부여를 더욱 세밀하게 제어할 수 있습니다.
        *   **예시**: `"Condition": {"IpAddress": {"aws:SourceIp": "203.0.113.0/24"}}` (특정 IP 범위에서만 접근 허용)

### 결론

AWS IAM 정책은 클라우드 보안의 초석을 다지는 중요한 도구입니다. 그룹, 사용자, 그리고 인라인 정책을 통해 유연하게 권한을 관리하고, JSON 형태의 정책 구조를 이해함으로써 `Version`, `Effect`, `Principal`, `Action`, `Resource`, `Condition`과 같은 핵심 요소들을 정확히 활용할 수 있습니다.

이러한 정책 메커니즘을 마스터하는 것은 AWS 환경에서 안전하고 효율적인 운영을 위해 필수적입니다. 복잡한 클라우드 환경에서 발생할 수 있는 잠재적 보안 위험을 최소화하고, 필요한 사용자에게만 적절한 권한을 부여하는 '최소 권한 원칙(Principle of Least Privilege)'을 구현하기 위해 IAM 정책에 대한 깊이 있는 이해와 적용 능력을 함양해야 합니다.